"use strict";tinymce.PluginManager.add("spoiler",function(i,a){const e="Заголовок спойлера";const f="Содержимое спойлера.";const q=i.settings.spoiler_windows?"Добавить/Изменить спойлер":"Добавить/Удалить спойлер";i.contentCSS.push(a+"/css/spoiler.min.css");i.ui.registry.addIcon("spoiler",'<svg width="24" height="24"><use xlink:href="'+a+'/img/spoiler_icons.svg#addspoiler"></use></svg>');var j={size:"large",body:{type:"panel",items:[{type:"input",name:"title",inputMode:"text",label:"Title"},{type:"textarea",flex:true,name:"body",label:"Body",minHeight:500,maximized:true}]},buttons:[{text:"Close",type:"cancel",onclick:"close"}]};function k(){var r=JSON.parse(JSON.stringify(j));r.title="Добавить спойлер";r.buttons.push({text:"Add",type:"submit",primary:true,enabled:false});r.onSubmit=b;return r}function c(r){var s=JSON.parse(JSON.stringify(j));s.title="Редактировать спойлер";s.buttons.push({text:"Change",type:"submit",primary:true,enabled:false});s.buttons.push({text:"Delete",type:"custom",primary:true});s.onSubmit=p;s.onAction=function(t){if(confirm("Вы действительно хотите удалить спойлер?")){h(r);t.close()}};return s}function b(t){var u=t.getData();var s=u.body;var r='<div class="spoiler" contenteditable="false"><div class="spoiler_head" title="Отобразить спойлер">'+u.title+'</div><div class="spoiler_body" contenteditable="true">'+s+"</div></div>";i.undoManager.transact(function(){i.insertContent(r)});t.close()}function p(s){var t=s.getData();var r=t.body;var u=document.createElement("div");u.className="spoiler";u.setAttribute("contenteditable","false");u.innerHTML='<div class="spoiler_head" title="Отобразить спойлер">'+t.title+'</div><div class="spoiler_body" contenteditable="true">'+r+"</div>";var v=o();i.undoManager.transact(function(){v.parentNode.replaceChild(u,v)});s.close()}function g(v,u,s,r){u=u||e;s=s||false;var t=s?c(r):k();t.initialData={title:u,body:v};i.windowManager.open(t)}function m(){var s=i.selection.getNode();if(i.dom.hasClass(s,"mce-content-body")){alert("С такой выделенной областью спойлер создать нельзя.");return}var t=i.selection.getContent();if(!t){t=f}if(i.settings.spoiler_windows){g(t)}else{var r='<div class="spoiler"><div class="spoiler_head" title="Отобразить спойлер">'+e+'</div><div class="spoiler_body">'+t+"</div></div>";i.undoManager.transact(function(){i.insertContent(r)})}}function n(s){var t=s.getElementsByClassName("spoiler_head")[0].textContent;var r=s.getElementsByClassName("spoiler_body")[0].innerHTML;g(r,t,true,s)}function h(r){if(r){var s=r.getElementsByClassName("spoiler_body")[0].innerHTML;if(s===f){r.remove()}else{var t=document.createElement("p");t.innerHTML=s;i.undoManager.transact(function(){r.parentNode.replaceChild(t,r)})}}}function o(){var r=null;var s=i.selection.getNode();if(i.dom.hasClass(s,"spoiler")){r=s}else{r=i.dom.getParent(s,".spoiler")}return r}function d(s){var r=o();if(r){if(i.settings.spoiler_windows){n(r)}else{h(r)}}else{m()}}function l(s){var r=function(t){s.setActive(o())};i.on("NodeChange",r);return function(){return i.off("NodeChange",r)}}i.ui.registry.addToggleButton("spoiler",{tooltip:q,icon:"spoiler",onAction:d,onSetup:l});i.ui.registry.addMenuItem("spoiler",{icon:"spoiler",text:q,context:"insert",onAction:d});return{getMetadata:function(){return{name:"Spoiler",url:"http://www.paradox-portal.ru/blog/article/7-sozdanie_plagina_spojler_dlya_tekstovogo_web_redaktora_tinymce_v5"}}}});